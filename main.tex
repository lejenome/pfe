% @Author: Moez Bouhlel

\documentclass[
a4paper,
12pt,
%twoside,
onecolumn,
titlepage,
final,
]{report} % {scrartcl}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[shorthands=off,english,french]{babel}
%\usepackage[fixlanguage]{babelbib}
%\usepackage{polyglossia}
%\setmainlanguage{french}
%\setotherlanguages{english}
\usepackage{csquotes}
\usepackage{soul}

\usepackage{abstract}
\renewcommand{\abstractnamefont}{\large\bfseries}
\usepackage[toc,page]{appendix}
\renewcommand{\appendixtocname}{Annexes}

\usepackage[nottoc]{tocbibind}
\usepackage[style=alphabetic,backend=bibtex8]{biblatex}
\addbibresource{bibliography.bib}

\usepackage{ifxetex,ifluatex}

%\usepackage{mathspec}
\usepackage{amssymb,amsmath}

%\usepackage{xltxtra,xunicode}
%\defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
%\setmainfont{TeX Gyre Pagella}
%\setsansfont{FreeSans}
%\setmonofont[Mapping=tex-ansi]{Monaco}

\usepackage{color}
\usepackage[table]{xcolor}

\usepackage{lmodern}
%\usepackage{tgpagella}
\usepackage{palatino}
\usepackage{helvet}
\fontfamily{ppl}\selectfont
% \fontsize{<nominal font size>}{<baselineskip>}\selectfont

\setlength{\parskip}{8pt}
\setlength{\parindent}{0pt}
\renewcommand{\baselinestretch}{1.2}\normalsize

\usepackage{graphicx}
\graphicspath{{figures/}, {diagrams/}}
\usepackage[update,prepend]{epstopdf}
\usepackage{background}
\usepackage{subcaption}
%\usepackage{svg}
\usepackage{array}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{needspace}

\usepackage[intoc]{nomencl}
\makenomenclature

\usepackage{url}
\usepackage[% setpagesize=false, % page size defined by xetex
            % unicode=false, % unicode breaks when used with xetex
            % xetex
            ]{hyperref}
\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor={Moez Bouhlel; Rihab Majdoub},
            pdftitle={La Platforme CityWatch},
            pdfsubject={Mémoire de projet de fin d'études - La Platforme CityWatch},
            pdfkeywords={CityWatch, Djagora, pfe, FSS, report, internship},
            pdflang={fr},
            pdfdisplaydoctitle=true,
            colorlinks=true, % false
            citecolor=blue,
            urlcolor=blue,
            linkcolor=magenta,
            bookmarksnumbered=true,
            pdfborder={0 0 0}}

\urlstyle{same}  % don't use monospace font for urls
% Make links footnotes instead of hotlinks:
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}

\usepackage{authblk}
\usepackage[acronym,toc]{glossaries}

\usepackage{minted}
%\usemintedstyle{borland}
%\usemintedstyle{tango}
\definecolor{darkBlue}{RGB}{4, 53, 98}
\definecolor{lightBlue}{RGB}{102, 153, 204}
\definecolor{lightGrey}{RGB}{245, 247, 249}
\definecolor{magenta}{RGB}{177, 0, 89}
\setminted{%
    mathescape,
    linenos=true,
    numbersep=5pt,
    frame=lines,
    framesep=2mm,
    %bgcolor=lightGrey,
    %rulecolor=lightBlue,
    %framerule=1.1pt,
    tabsize=4,
}

% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}

\usepackage{geometry}
\geometry{%
    left=3.5cm,
    right=2.5cm,
    paper=a4paper, % Change to letterpaper for US letter
    %inner=2.5cm, % Inner margin
    %outer=3.8cm, % Outer margin
    %bindingoffset=.5cm, % Binding offset
    top=3cm, % Top margin
    bottom=2.5cm, % Bottom margin
    %showframe, % Uncomment to show how the type block is set on the page
}

%%% Custom sectioning
\usepackage{sectsty}
\allsectionsfont{\large\bfseries\scshape}

\usepackage{titlesec}
\newcommand{\hsp}{\hspace{20pt}}
\definecolor{gray75}{gray}{0.75}
\titleformat{\chapter}[hang]{\Huge\bfseries}{\thechapter\hsp\textcolor{gray75}{|}\hsp}{0pt}{\Huge\bfseries\scshape}
\titleformat{\section}[block]{\LARGE\bfseries}{\thesection \hsp {---}\hsp}{0pt}{\LARGE\bfseries}
\titleformat{\subsection}[block]{\Large\bfseries}{\thesubsection \ }{0pt}{\Large \bfseries}
\titleformat{\subsubsection}[block]{\large\bfseries}{\thesubsubsection \ }{0pt}{\large \bfseries}
\usepackage[shortlabels]{enumitem}

%%% Custom headers/footers (fancyhdr package)
\usepackage{fancyhdr}
\usepackage[bottom]{footmisc}

\usepackage{fancyvrb}
\VerbatimFootnotes

%%% Equation and float numbering
%\numberwithin{equation}{section}   % Equationnumbering: section.eq#
%\numberwithin{figure}{section}     % Figurenumbering: section.fig#
%\numberwithin{table}{section}      % Tablenumbering: section.tab#

\makeglossaries
\input{51-glossary}

\title{La Platforme CityWatch - Memoire de Projet de Fin d'Etudes}
\author{Moez Bouhlel}
\author{Rihab Majdoub}
\affil{Faculté des Sciences de Sfax, Tunisie}

\usepackage{tikz}
\usepackage{pgfplots}
\usetikzlibrary{arrows.meta}
\tikzset{%
  >={Latex[width=2mm,length=2mm]},
  base/.style = {rectangle, rounded corners, draw=black,
      minimum width=4cm, minimum height=1cm,
      text centered, font=\sffamily},
  activityStarts/.style = {base, fill=blue!30},
  startstop/.style = {base, fill=red!30},
  activityRuns/.style = {base, fill=green!30},
  process/.style = {base, minimum width=2.5cm, fill=orange!15, font=\ttfamily},
}

\usepackage{todonotes}
\newcommand{\TODO}[1]{\setlength{\marginparwidth}{2cm}\todo{#1}}
\newcommand{\HTODO}[2]{\setlength{\marginparwidth}{2cm}\colorbox{yellow}{#1}\todo{#2}}
\newcommand{\FIXME}[1]{\setlength{\marginparwidth}{2cm}\todo[backgroundcolor=red]{#1}}
\newcommand{\HFIXME}[2]{\setlength{\marginparwidth}{2cm}\colorbox{pink}{#1}\todo[backgroundcolor=red]{#2}}
\newcommand{\DONE}[1]{\setlength{\marginparwidth}{2cm}\todo[done]{#1}}
\newcommand{\HDONE}[2]{\setlength{\marginparwidth}{2cm}\colorbox{green}{#1}\todo[done,backgroundcolor=green]{#2}}

\begin{document}
\SetBgContents{}

\input{00-title}

\pagestyle{empty}
\pagenumbering{roman}

\include{01-quote}
\cleardoublepage
\include{02-abstract}
\include{03-dedicaces}
\include{04-merci}
\fancypagestyle{plain}{%
    \fancyhf{}
    \rfoot{\thepage}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}
\pagestyle{plain}

\setlength{\parskip}{0pt}
\hypersetup{linkcolor=black}
\setcounter{tocdepth}{3}

\tableofcontents

\clearpage
%\addcontentsline{toc}{section}{Table des figures}
\listoffigures

\clearpage
%\addcontentsline{toc}{section}{Liste des tableaux}
\listoftables

%\clearpage
%\renewcommand\listoflistingscaption{Liste des codes sources}
%\addcontentsline{toc}{section}{Liste des codes sources}
%\listoflistings

%\clearpage

% list of abbreviations
%\nomenclature{$c$}{Speed of light in a vacuum inertial frame}
%\nomenclature{$h$}{Planck constant}

%\printnomenclature

\cleardoublepage
\setlength{\parskip}{8pt}
\renewcommand{\baselinestretch}{1.4}\normalsize
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{1pt}
%\fancyhead[LE,RO]{\itshape CityWatch}
\rhead{\rightmark}
\rfoot{\thepage}
%\setlength{\headheight}{13.6pt}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ \ --\ \ #1}}
\pagenumbering{arabic}

\cleardoublepage
\chapter{Introduction Générale}
\backgroundsetup{contents=WIP,scale=8,position={0.9,-1.5},opacity=0.6}
\input{10-introduction}

\cleardoublepage
\SetBgContents{}
\chapter{Contexte du Projet}
\input{20-cadreprojet}

\cleardoublepage
\chapter{Itérations}
\input{30-sprint0}
\include{31-sprint1}
\include{32-sprint2}
\backgroundsetup{contents=WIP,scale=8,position={0.9,-1.5},opacity=0.6}
\include{33-sprint3}
\SetBgContents{}

%%%% INCLUDE CHAPTERS

\cleardoublepage
\renewcommand{\sectionmark}[1]{\markright{\thesection\ \ --\ \ #1}}
%\appendix
\begin{appendices}
\input{50-appendix}
\end{appendices}

\cleardoublepage
\fancypagestyle{plain}{%
    \fancyhf{}
    \rfoot{\thepage}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}
\pagestyle{plain}

% \printglossary[type=\acronymtype]
%\addcontentsline{toc}{section}{Glossaire des Acronymes}
\glossarystyle{listgroup}
\glsaddall
\printglossaries

\clearpage
\nocite{*}
\printbibheading
\printbibliography[type=book,heading=subbibliography,title={Livres}]
\printbibliography[nottype=book,heading=subbibliography,title={Autres Sources}]

% \listoftodos % TODO FIXME list

\end{document}
